 <!-- 
    Description of project
-->
 
 <html>
  <head>
    <script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
    <script src="js/go-button.js"></script>
    <script src="js/grabbing.js"></script>
    <script src="js/reset-button.js"></script>
    <script src="https://unpkg.com/aframe-physics-system@1.4.0/dist/aframe-physics-system.min.js"></script>
    <script src="js/done.js"></script>
    <script src="js/new-geo.js"></script>

  </head>
    <body>
      <a-scene id= "scen" physics="friction: 0.1">
        <a-entity id="rig" position="-1 -6.8 5" >
          <a-entity id="camera" camera look-controls wasd-controls position="0 1.3 0">
            <a-entity geometry="primitive: plane; height: 0.2; width: 0.2" position="0 0 -1"
            material="color: gray; opacity: 0.5"></a-entity>

          </a-entity>
          <a-entity cursor="rayOrigin:mouse;"
                    raycaster="far:20; interval:100; objects:.clickable;">
          <a-entity id="leftController" static-body="shape: sphere; sphereRadius: 0.02;" oculus-touch-controls="hand: left" sphere-collider="objects: .grabbable" grab="" collider=""></a-entity>
          <a-entity id="rightController" static-body="shape: sphere; sphereRadius: 0.02;" oculus-touch-controls="hand: right" sphere-collider="objects: .grabbable" grab="" collider=""></a-entity>
          <!--id="leftController" static-body="shape: sphere; sphereRadius: 0.02;" oculus-touch-controls="hand: left" sphere-collider="objects: .grabbable" grab-->
          <a-entity id="sphere-collider"
              geometry="primitive: sphere; radius: 0.1"
              material="color: #4CC3D9; shader: standard"
              Collider=""
              static-body>
          </a-entity>
          </a-entity>
        </a-entity>

        <a-assets>
          <img id="skyTexture" src="assets/textures/rocky.jpg">
          <a-asset-item id="corkboardObj" src="assets/models/CorkBoard.obj"></a-asset-item>

          <a-asset-item id="bucketObj" src="assets/models/Bucket.obj"></a-asset-item>

          <a-asset-item id="tableObj" src="assets/models/Table.obj"></a-asset-item>
          
          <a-asset-item id="wallsObj" src="assets/models/Walls.obj"></a-asset-item>

          <a-asset-item id="ceilingObj" src="assets/models/Ceiling.obj"></a-asset-item>

          <a-asset-item id="pipeObj" src="assets/models/Pipe.obj"></a-asset-item>

          <a-asset-item id="sidepipeObj" src="assets/models/Side_Pipe.obj"></a-asset-item>

          <a-asset-item id="ventObj" src="assets/models/Vent.obj"></a-asset-item>
  
        </a-assets>
        <a-sky id="background" src="#skyTexture"></a-sky>

        <a-entity id="player_ball"
                    geometry="primitive: sphere; radius: 0.04"
                    material="color: #4CC3D9; shader: standard"
                    position="-1.6 -4.9 3.77"
                    rotation="0 0 0"
                    static-body>
        </a-entity>

        <a-entity id="done_button"
        class="clickable grabbable"
          geometry="primitive: box; width: 0.2; height: 0.05; depth: 0.1"
                    material="color: green; shader: standard"
                    position="-1.7 -5.95 4"
                    rotation="0 0 0"
                    go-button="">
        </a-entity>

        <a-entity id="reset_button"
                    class="clickable grabbable"
                    geometry="primitive: box; width: 0.2; height: 0.05; depth: 0.1"
                    material="color: red; shader: standard"
                    position="-1.7 -5.95 4.2"
                    rotation="0 0 0"
                    reset-button="">
        </a-entity>

        <a-entity id="walls"
                    obj-model="obj: #wallsObj"
                    material="src:assets/textures/WallsTexture.png;"
                    position="-1 -7 6"
                    rotation="0 0 0"
                    scale="0.2 0.2 0.2"
                    static-body>
        </a-entity>

        <a-entity id="ceiling"
                    obj-model="obj: #ceilingObj"
                    material="src:assets/textures/CeilingTexture.png;"
                    position="-1 -7 6"
                    scale="0.2 0.2 0.2"
                    rotation="0 0 0">
        </a-entity>

        <a-entity id="sidepipe"
                obj-model="obj: #sidepipeObj"
                material="src:assets/textures/Pipe_SupportTexture.png;"
                position="-1 -7 6"
                scale="0.2 0.2 0.2"
                rotation="0 0 0">
        </a-entity>

        <a-entity id="pipe"
                obj-model="obj: #pipeObj"
                material="src:assets/textures/PipesTexture.png;"
                position="-0.3 -7 5.9"
                rotation="0 90 0"
                scale="0.2 0.2 0.2">
        </a-entity>
        
        <a-entity id="vent"
                obj-model="obj: #ventObj"
                material="src:assets/textures/VentTexture.png;"
                position="-1 -7 6"
                scale="0.2 0.2 0.2"
                rotation="0 0 0">
        </a-entity>
        
        <a-entity id="bucket"
                    obj-model="obj: #bucketObj"
                    material="color: purple; shader: standard"
                    position="-0.4 -5.9 4.5"
                    rotation="0 0 0"
                    scale="0.07 0.07 0.07"
                    static-body>
        </a-entity>

        <a-entity id="corkBoard"
                    obj-model="obj: #corkboardObj"
                    material="src:assets/textures/CorkBoardTexture.png;"
                    position="-1 -6.5 4.9"
                    rotation="0 0 0"
                    scale="0.1 0.1 0.1"
                    static-body>
        </a-entity>

        <a-entity id="table"
                    obj-model="obj: #tableObj"
                    material="src:assets/textures/TableTexture.png;"
                    position="-0.3 -7 5.9"
                    rotation="0 90 0"
                    scale="0.2 0.2 0.2"
                    static-body>
        </a-entity>

        <a-entity id="spot"
                    position="0 0 0"
        ></a-entity>

        <a-entity id="piece"
                    geometry="primitive: box; width: 2; height: 2; depth: 2"
                    class="clickable notgrab"
                    material="color: green; shader: standard"
                    position="8 1 0"
                    grabbing=""
                    static-body>
        </a-entity>
        <a-plane id="glass" position="0 -4 3.93" rotation="180 0 0" width="20" height="20" color= blue static-body material="opacity: 0.5"></a-plane>
        <a-plane id="glass2" position="0 -5.97 3.93" rotation="-90 0 0" width="20" height="20" color= blue static-body material="opacity: 0.0"></a-plane>

      </a-scene>

      <script src="/socket.io/socket.io.js"></script>
      <script>
        let socket = io();

        let counter = 0;

        //default connect event
        socket.on('connect', function() {
                console.log("connected!");
        });

        socket.on('generate_shape', function(data) {
          console.log("shape received");

          var x = -Math.random() * 1.4;
          var z = Math.random() * 0.4 + 4;

          let createdShape = document.createElement('a-entity');
            createdShape.setAttribute('id', 'shape' + counter);

            createdShape.setAttribute('new-geo', '');
            createdShape.setAttribute('class', "clickable notgrab grabbable");
            createdShape.setAttribute('geometry', 'primitive: new-geo; vertices:' + data.verts);
            createdShape.setAttribute('position', '-1 -4.4 4'); 
            createdShape.setAttribute('scale', '0.1 0.1 0.1');

            createdShape.setAttribute('animation', 'property: position; to: ' + (x) + ' -5.98 '+ (z) +'; loop:false; dur: 1200');
             
            createdShape.addEventListener('loaded', function(){
                createdShape.setAttribute('material', 'color:' + data.material + "; side: double");
                createdShape.setAttribute('grabbing', '');
                createdShape.setAttribute('static-body', '');
            })
            
            counter++;

            let scene = document.querySelector('a-scene');
            scene.appendChild(createdShape);
        });


        
      
      </script>
    </body>
</html>